# 日本語テキスト抽出プログラム 設計計画

**目的:** `img/` ディレクトリ内のスクリーンショット画像から日本語テキストを抽出し、精度を評価するシンプルなツール。

## 1. プロジェクト構造設計

**ディレクトリ・ファイル構成:**

- **`src/`**: メインとなるソースコード。
  - **`main.py`**: エントリーポイント。引数処理、モジュール呼び出し。
  - **`ocr/`**: OCRエンジン関連。
    - `base.py`: OCRエンジンの基底クラス。
    - `ocr_engine.py`: OCRエンジンの共通インターフェース。
    - `easyocr_engine.py`: EasyOCR実装。
    - `tesseract_engine.py`: Tesseract実装。
  - **`preprocessing/`**: 画像前処理関連。
    - `image_processor.py`: 画像処理のメインクラス。
    - `preprocessor.py`: 前処理メソッドの実装。
  - **`evaluation/`**: 精度評価関連。
    - `evaluator.py`: テキスト評価の実装。
    - `metrics.py`: 評価指標の計算。
  - **`utils/`**: 共通ユーティリティ。
    - `file_utils.py`: ファイル操作ユーティリティ。
  - **`config/`**: 設定関連。
    - `config_loader.py`: 設定ファイル読み込み。
- **`data/`**: 入力データ。
  - **`img/`**: 処理対象の画像ファイル (固定)。
  - **`expected/`**: 正解データファイル (固定)。
- **`results/`**: OCR結果や評価結果の保存先 (固定)。
- **`config/`**: 設定ファイル。
  - **`settings.yaml`**: プログラム設定。
- **`tests/`**: テストコード。
- **`docs/`**: ドキュメント。
  - **`design_plan.md`**: この設計計画ファイル。
- **`README.md`**: プロジェクト説明書。
- **`pyproject.toml`, `uv.lock`**: 依存関係管理。
- **`.gitignore`**: Git管理除外ファイル。
- **`LICENSE`**: ライセンス。

**モジュール分割の方針:**

- 機能ごとに分割し、共通関数は集約して再利用性を高める。
- 実装する機能は必要最低限に絞る。

**設定ファイルの扱い:**

- `config/settings.yaml` に基本設定を集約。
- パス関連はコード内固定またはシンプルな引数で指定。

```yaml
# 設定方法
OCRエンジンごとに最適なデフォルト設定を使用：

- EasyOCR: 日本語・英語対応
  - 言語: ['ja', 'en']
  - confidence_threshold: 0.2

- Tesseract: 日本語対応
  - 言語: jpn
  - PSM: デフォルト値使用
```

## 2. 機能

- **対象:** 単一の画像ファイル（PNG, JPG など）。
- **処理:** ファイル単位で処理。
- **出力:** 標準出力に抽出テキストと精度を表示。
- **前処理:** `none`, `basic`, `adaptive`, `otsu` から選択。
- **評価:** 標準精度と正規化精度の2種類で評価。

## 3. 使い方

- **実行:** `python main.py <画像ファイルパス> [オプション]`
- **必須引数:**
  - 画像ファイルパス: 処理する画像ファイルへのパス
- **オプション引数:**
  - `--engine <name>`: OCRエンジン (`easyocr` or `tesseract`、デフォルト: easyocr)
  - `--preprocess <method>`: 前処理方法 (`none`, `basic`, `adaptive`, `otsu`、デフォルト: none)
- **表示:**
  - 処理段階の表示（前処理、OCR処理）
  - 抽出されたテキストの表示
  - 精度評価結果の表示（標準精度、正規化精度）
- **エラーハンドリング:**
  - 一時ファイルの適切な削除
  - 基本的なエラーメッセージ表示

## 4. ドキュメンテーション

- **README.md:** 概要、インストール、使い方、オプション説明
